name: System Monitor & Auto-Backup

on:
  push:
    branches:
      - main
  schedule:
    - cron: "0 3 * * *"
  workflow_dispatch:

jobs:
  cleanup:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v3
        with:
          submodules: false
          fetch-depth: 1
      - name: ğŸ” Debug Directory Permissions
        run: |
          echo "ğŸ” Checking Current User & Groups"
          whoami
          id

          echo "ğŸ” Checking Home Directory"
          ls -ld ~

          echo "ğŸ” Checking automation_logs Directory"
          ls -ld automation_logs || echo "ğŸš¨ automation_logs NOT FOUND!"

          echo "ğŸ” Checking backups Directory"
          ls -ld backups || echo "ğŸš¨ backups NOT FOUND!"

      - name: ğŸ”§ Fix Permissions for automation_logs
        run: |
          chmod -R 777 automation_logs

      - name: ğŸ“‚ Verify Files Exist
        run: |
          echo "Current Directory: $(pwd)"
          ls -la

      - name: ğŸ§¹ Run Cleanup Script
        run: python3 cleanup_files.py

      - name: ğŸ“¤ Commit and Push Backup Changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add backups/
          git commit -m "ğŸ› ï¸ Automated backup update [CI]" || echo "No changes to commit"
          git push origin main || echo "No changes to push"
