name: System Monitor & Auto-Backup

on:
  push:
    branches:
      - main
  schedule:
    - cron: "0 3 * * *" # Runs every day at 03:00 UTC
  workflow_dispatch: # Allows manual triggering

jobs:
  cleanup:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout Repository
        uses: actions/checkout@v3
        with:
          submodules: false # Prevents submodule errors
          fetch-depth: 1 # Only fetch the latest commit

      - name: 📂 Verify Files Exist (Debugging)
        run: |
          echo "Current Directory: $(pwd)"
          echo "Listing Files:"
          ls -la

      - name: 🧹 Run Cleanup Script
        run: |
          python3 cleanup_files.py
        working-directory: ${{ github.workspace }}

      - name: 📤 Commit and Push Backup Changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add backups/
          git commit -m "🛠️ Automated backup update [CI]" || echo "No changes to commit"
          git push origin main || echo "No changes to push"
